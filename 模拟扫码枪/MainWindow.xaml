<Window x:Class="模拟扫码枪.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:模拟扫码枪"
        mc:Ignorable="d"
        WindowStartupLocation="CenterScreen"
        Closing="Window_Closing"
        Title="模拟扫码枪" Height="480" Width="800"> 
    <Window.DataContext>
        <local:MainWindowViewModel />
    </Window.DataContext>
    <Window.Resources>
        <DataTemplate x:Key="dtScanner" DataType="{x:Type local:ScannerModel}">
            <Border Background="White" BorderBrush="Black" BorderThickness="1" >
                <StackPanel>
                    <StackPanel.Resources>
                        <Style TargetType="DockPanel">
                            <Setter Property="Margin" Value="3"/>
                        </Style>
                        <Style TargetType="TextBlock" >
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                            <Setter Property="MinWidth" Value="65"/>
                        </Style>
                        <Style TargetType="CheckBox" >
                            <Setter Property="Margin" Value="5,0,0,0"/>
                        </Style>
                        <Style TargetType="TextBox">
                            <Setter Property="MinHeight" Value="22"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                        </Style>
                    </StackPanel.Resources>
                    <DockPanel>
                        <Border Width="15" Height="15" Background="{Binding StatusBrush}"/>
                        <CheckBox IsChecked="{Binding IsEnable}" Content="启用" VerticalAlignment="Center"/>
                        <CheckBox IsChecked="{Binding IsUseTriggerString}" Content="校验触发字符串" VerticalAlignment="Center"/>
                        <CheckBox IsChecked="{Binding AppendHexString}" Content="HEX(流水号/随机数)" VerticalAlignment="Center"/>
                        <TextBox Text="{Binding ClientCount,Mode=OneWay}" IsReadOnly="True" Margin="5,0,0,0"/>
                    </DockPanel>
                    <DockPanel >
                        <TextBlock Text="名称"/>
                        <TextBox Text="{Binding Name}"/> 
                    </DockPanel>
                    <DockPanel  IsEnabled="{Binding IsEnable, Converter={local:BoolReverseConverter}}">
                        <TextBlock Text="接口类型"/>
                        <UniformGrid Columns="2"  >
                            <ComboBox ItemsSource="{Binding DeviceTypeValues}" SelectedItem="{Binding DeviceType}"  /> 
                            <ComboBox ItemsSource="{Binding WorkModelValues}" SelectedItem="{Binding WorkModel}" Margin="5,0,0,0"/> 
                        </UniformGrid>
                    </DockPanel>
                    <DockPanel IsEnabled="{Binding IsEnable, Converter={local:BoolReverseConverter}}">
                        <TextBlock Text="附加内容"/>
                        <UniformGrid Columns="2" >
                            <ComboBox ItemsSource="{Binding ResponseModelValues}" SelectedItem="{Binding ResponseModel}" />
                            <ComboBox ItemsSource="{Binding AppendContentValues}" SelectedItem="{Binding AppendContent}" Margin="5,0,0,0"/>
                        </UniformGrid>
                    </DockPanel>
                    <DockPanel IsEnabled="{Binding IsEnable, Converter={local:BoolReverseConverter}}" Visibility="{Binding IsNetwork,Converter={local:BoolToVisibilityConverter }}">
                        <TextBlock Text="IP|Port"/>
                        <UniformGrid Columns="2"> 
                            <TextBox Text="{Binding IP}"  />
                            <TextBox Text="{Binding Port}" Margin="5,0,0,0"/>
                        </UniformGrid>
                    </DockPanel>
                    <DockPanel  IsEnabled="{Binding IsEnable, Converter={local:BoolReverseConverter}}" Visibility="{Binding IsSerialPort ,Converter={local:BoolToVisibilityConverter}}">
                        <TextBlock Text="串口名"/>
                        <ComboBox SelectedValue="{Binding PortName}" ItemsSource="{Binding PortNames}"/>
                    </DockPanel>
                    <DockPanel IsEnabled="{Binding IsEnable, Converter={local:BoolReverseConverter}}" Visibility="{Binding IsSerialPort ,Converter={local:BoolToVisibilityConverter}}">
                        <TextBlock Text="串口参数"/>
                        <DockPanel Margin="0">
                            <TextBox Text="{Binding BaudRate}" MinWidth="80"/>
                            <TextBox Text="{Binding DataBits}"  MinWidth="50"/>
                            <ComboBox SelectedValue="{Binding Parity}" ItemsSource="{Binding ParityValues}" />
                            <ComboBox SelectedValue="{Binding StopBits}" ItemsSource="{Binding StopBitsValues}"/>
                        </DockPanel>
                    </DockPanel> 
                    <DockPanel>
                        <TextBlock Text="触发内容"/>
                        <TextBox Text="{Binding TriggerString}"/>
                    </DockPanel>
                    <DockPanel>
                        <TextBlock Text="发送内容"/>
                        <Button Content="发送" Command="{Binding  SendCommand}" DockPanel.Dock="Right" Margin="5,0,0,0"/>
                        <TextBox Text="{Binding AutoSendInterval}" MinWidth="50" Margin="5,0,0,0" DockPanel.Dock="Right"/>
                        <TextBox Text="{Binding SendString}"/>
                    </DockPanel>
                    <DockPanel>
                        <TextBlock Text="接收内容"/>
                        <CheckBox IsChecked="{Binding IsTransmitReceiveDataToStandardInput}" IsEnabled="{Binding IsOnlyReceiveModel}" VerticalAlignment="Center" Content="转发仅接收内容" DockPanel.Dock="Right" Margin="5,0,0,0"/>
                        <TextBox Text="{Binding ReceiveString}"/>
                    </DockPanel>
                    <DockPanel>
                        <TextBlock Text="流水号"/>
                        <TextBox Text="{Binding AppendContentLength}" MinWidth="50" ToolTip="附加内容长度" Margin="5,0,0,0" DockPanel.Dock="Right"/>
                        <TextBox Text="{Binding OrderIndex}"/>
                    </DockPanel>
                    <Button Content="关闭" Click="Button_Click" MinHeight="35"/>
                </StackPanel>
            </Border>
        </DataTemplate>
    </Window.Resources>
    <Grid >

        <Grid Margin="5">
            <Grid.Effect>
                <BlurEffect Radius="{Binding BlurEffectRadius}"/>
            </Grid.Effect>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <GroupBox Header="消息" Grid.Column="1" Padding="5">
                <ScrollViewer >
                    <TextBox Text="{Binding Msg}" AcceptsReturn="True"    MouseDoubleClick="Window_MouseDoubleClick"/>
                </ScrollViewer>
            </GroupBox>

            <GroupBox Header="设备列表" Grid.Column="0" Padding="5">
                <DockPanel >
                    <UniformGrid DockPanel.Dock="Bottom" Columns="3">
                        <UniformGrid.Resources>
                            <Style TargetType="Button">
                                <Setter Property="MinHeight" Value="35"/>
                                <Setter Property="Margin" Value="5"/>
                            </Style>
                        </UniformGrid.Resources>
                        <Button Content="增加" Foreground="DarkGreen" Command="{Binding AddItemCommand}"/>
                        <Button Content="删除" Foreground="DarkRed" Command="{Binding RemoveItemCommand}"/>
                        <Button Content="保存" Foreground="DarkBlue" Command="{Binding SaveListCommand}"/>
                    </UniformGrid>
                    <ListView ItemsSource="{Binding Scanners}"   SelectedItem="{Binding SelectedItem}"  MouseDoubleClick="ListView_MouseDoubleClick">
                        <ListView.ItemTemplate>
                            <DataTemplate DataType="local:ScannerModel">
                                <StackPanel Orientation="Horizontal" >
                                    <Border Width="15" Height="15" Background="{Binding StatusBrush}"  Margin="5,0,0,0"/>
                                    <CheckBox IsChecked="{Binding IsEnable}" VerticalAlignment="Center"  Margin="5,0,0,0"/>
                                    <TextBlock Text="{Binding DeviceType}" Margin="5,0,0,0"/>
                                    <TextBox Text="{Binding Name}" MinWidth="120" Margin="5,0,0,0"/>
                                    <TextBox Text="{Binding ReceiveString}" MinWidth="250" Margin="5,0,0,0"/>
                                    <TextBox Text="{Binding ClientCount,Mode=OneWay}" MinWidth="20" IsReadOnly="True" Margin="5,0,0,0"/>
                                    <Button Content="发送" Command="{Binding  SendCommand}" Margin="5,0,0,0" MouseDoubleClick="Button_MouseDoubleClick"/>
                                </StackPanel>
                            </DataTemplate>

                        </ListView.ItemTemplate>

                    </ListView>
                </DockPanel>
            </GroupBox>
        </Grid>

        <Grid Margin="5">
            <Border  Visibility="{Binding PropertyVisibility}"  Background="Transparent" >
                <Border.Effect>
                    <DropShadowEffect Color="Black" ShadowDepth="5" BlurRadius="5" />
                </Border.Effect> 
            </Border>

            <ContentControl MinWidth="500"  VerticalAlignment="Center"  HorizontalAlignment="Center" Visibility="{Binding PropertyVisibility}" 
                Content="{Binding SelectedItem}"
                ContentTemplate="{StaticResource dtScanner}"
                Background="Transparent" >
                        <ContentControl.Effect>
                            <BlurEffect Radius="0"/>
                        </ContentControl.Effect>
                    </ContentControl>
            
        </Grid>
    </Grid>
</Window>
